<!DOCTYPE html>
<html lang="en" class="w-100 h-100" data-bs-theme="dark">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Login Page</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	</head>
	<body class="d-flex align-items-center justify-content-center h-100" style="width: clamp(400px, 100%, 1600px);">
		<form id="login-form" style="width: clamp(400px, 50%, 800px);" method="post">
			<div class="form-group">
				<label class="form-label" for="user-email">E-mail:</label>
				<input class="form-control" type="email" name="user-email" id="user-email" required>
				<label class="form-label" for="user-password">Password:</label>
				<input class="form-control" type="password" name="user-password" id="user-password" required>
				<div>
					<p id="error-message"></p>
				</div>
				<div class="row">
					<div class="col d-flex align-items-center justify-content-center">
						<input type="submit" value="Submit">
					</div>
					<div class="col d-flex align-items-center justify-content-center">
						<input type="Reset" value="Reset">
					</div>
				</div>
			</div>
		</form>
	</body>
	<script type="module">
		import { db, auth, GoogleAuthProvider, signInWithEmailAndPassword } from "../../firebase.js";
		const form = document.getElementById("login-form");
		const msg = document.getElementById("error-message");
		async function handleLogin(event) {
			msg.textContent = "";
			event.preventDefault();
			try {
				const data = new FormData(event.target);
				const email = data.get("user-email");
				const password = data.get("user-password");
				const credentials = await signInWithEmailAndPassword(auth, email, password);
				const user = credentials.user;
				const response = await fetch("../../api/signin.php", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify(user)
				});
				const result = await response.json();
                if (response.ok && result.success) {
                    // Redirect to a dashboard or another page
                    window.location.href = "./dashboard.php";
                } else {
                    msg.textContent = `Server verification failed: ${result.error || "Unknown server error"}`;
                }
			} catch (err) {
                msg.textContent = err.message;
			}
		}

		form.addEventListener("submit", handleLogin);
	</script>
</html>